package com.memtrip.eos_evm.eos.evm.contracts.misc

import com.memtrip.eos.chain.actions.ChainResponse
import com.memtrip.eos.core.crypto.EosPrivateKey
import com.memtrip.eos.http.rpc.model.transaction.response.TransactionCommitted
import com.memtrip.eos_evm.eos.evm.EvmContract
import com.memtrip.eos_evm.eos.evm.EvmSender
import com.memtrip.eos_evm.eos.evm.contracts.CreateResponse
import com.memtrip.eos_evm.ethereum.EthAccount
import io.reactivex.Single
import org.web3j.abi.TypeReference
import org.web3j.abi.datatypes.DynamicArray
import org.web3j.abi.datatypes.Uint

/**
pragma solidity ^0.5.11;

contract Contract {
    uint[] public values;

    constructor() public {
    }

    function find(uint value) private view returns(uint) {
        uint i = 0;
        while (values[i] != value) {
            i++;
        }
        return i;
    }

    function removeByValue(uint value) private {
        uint i = find(value);
        removeByIndex(i);
    }

    function removeByIndex(uint i) private {
        while (i<values.length-1) {
            values[i] = values[i+1];
            i++;
        }
        values.length--;
    }

    function getValues() private view returns(uint[] memory) {
        return values;
    }

    function test() public returns(uint[] memory) {
        values.push(10);
        values.push(20);
        values.push(30);
        values.push(40);
        values.push(50);
        removeByValue(30);
        return getValues();
    }
}
*/
class RemoveFromArrayContract(
    contractAccountName: String,
    contractPrivateKey: EosPrivateKey,
    contractEthAccount: EthAccount
) : EvmContract(
    contractAccountName,
    contractPrivateKey,
    contractEthAccount,
    "608060405234801561001057600080fd5b50610398806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80635e383d211461003b578063f8a8fd6d1461007d575b600080fd5b6100676004803603602081101561005157600080fd5b81019080803590602001909291905050506100dc565b6040518082815260200191505060405180910390f35b6100856100fd565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156100c85780820151818401526020810190506100ad565b505050509050019250505060405180910390f35b600081815481106100e957fe5b906000526020600020016000915090505481565b60606000600a90806001815401808255809150509060018203906000526020600020016000909192909190915055506000601490806001815401808255809150509060018203906000526020600020016000909192909190915055506000601e90806001815401808255809150509060018203906000526020600020016000909192909190915055506000602890806001815401808255809150509060018203906000526020600020016000909192909190915055506000603290806001815401808255809150509060018203906000526020600020016000909192909190915055506101ea601e6101f7565b6101f2610211565b905090565b600061020282610269565b905061020d816102a5565b5050565b6060600080548060200260200160405190810160405280929190818152602001828054801561025f57602002820191906000526020600020905b81548152602001906001019080831161024b575b5050505050905090565b600080600090505b826000828154811061027f57fe5b90600052602060002001541461029c578080600101915050610271565b80915050919050565b5b6001600080549050038110156102f957600060018201815481106102c657fe5b9060005260206000200154600082815481106102de57fe5b906000526020600020018190555080806001019150506102a6565b600080548091906001900361030e9190610312565b5050565b81548183558181111561033957818360005260206000209182019101610338919061033e565b5b505050565b61036091905b8082111561035c576000816000905550600101610344565b5090565b9056fea265627a7a72315820d358222b69a76aaa7298e2af599ef28d215dd82793b3f12f692faa12ff13774064736f6c63430005100032"
) {

    fun createContract(): Single<CreateResponse> {
        return create(listOf())
    }

    fun test(sender: EvmSender): Single<ChainResponse<TransactionCommitted>> {
        return executeMethod(
            "test",
            listOf(),
            listOf(object : TypeReference<DynamicArray<Uint>>() { }),
            sender
        )
    }
}