package com.memtrip.eos_evm.eos.evm.contracts.misc

import com.memtrip.eos.chain.actions.ChainResponse
import com.memtrip.eos.core.crypto.EosPrivateKey
import com.memtrip.eos.http.rpc.model.transaction.response.TransactionCommitted
import com.memtrip.eos_evm.eos.evm.EvmContract
import com.memtrip.eos_evm.eos.evm.EvmSender
import com.memtrip.eos_evm.ethereum.EthAccount
import io.reactivex.Single
import org.web3j.abi.TypeReference
import org.web3j.abi.datatypes.DynamicArray
import org.web3j.abi.datatypes.generated.Uint256
import java.math.BigInteger

/**
pragma solidity ^0.5.11;

contract ArrayMessageArgs {
    uint256[] numbers;

    function makeA() public returns (uint256) {
        numbers.push(10);

        A a = new A(numbers);

        return a.numbers(0);
    }
}

contract A {
    uint256[] public numbers;
    constructor(uint256[] memory _numbers) public {
        for(uint256 i=0; i<_numbers.length; i++) {
            numbers.push(_numbers[i]);
        }
    }

    function get() public returns (uint256[] memory) {
        return numbers;
    }
}
*/
class ArrayMessageArgsContract(
    contractAccountName: String,
    contractPrivateKey: EosPrivateKey,
    contractEthAccount: EthAccount
) : EvmContract(
    contractAccountName,
    contractPrivateKey,
    contractEthAccount,
    "0x608060405234801561001057600080fd5b50610487806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063cb85227114610030575b600080fd5b61003861004e565b6040518082815260200191505060405180910390f35b600080600a908060018154018082558091505090600182039060005260206000200160009091929091909150555060008060405161008b90610185565b808060200182810382528381815481526020019150805480156100cd57602002820191906000526020600020905b8154815260200190600101908083116100b9575b505092505050604051809103906000f0801580156100ef573d6000803e3d6000fd5b5090508073ffffffffffffffffffffffffffffffffffffffff1663d39fa23360006040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561014457600080fd5b505afa158015610158573d6000803e3d6000fd5b505050506040513d602081101561016e57600080fd5b810190808051906020019092919050505091505090565b6102c0806101938339019056fe608060405234801561001057600080fd5b506040516102c03803806102c08339818101604052602081101561003357600080fd5b810190808051604051939291908464010000000082111561005357600080fd5b8382019150602082018581111561006957600080fd5b825186602082028301116401000000008211171561008657600080fd5b8083526020830192505050908051906020019060200280838360005b838110156100bd5780820151818401526020810190506100a2565b5050505090500160405250505060008090505b81518110156101255760008282815181106100e757fe5b6020026020010151908060018154018082558091505090600182039060005260206000200160009091929091909150555080806001019150506100d0565b505061018a806101366000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80636d4ce63c1461003b578063d39fa2331461009a575b600080fd5b6100436100dc565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561008657808201518184015260208101905061006b565b505050509050019250505060405180910390f35b6100c6600480360360208110156100b057600080fd5b8101908080359060200190929190505050610134565b6040518082815260200191505060405180910390f35b6060600080548060200260200160405190810160405280929190818152602001828054801561012a57602002820191906000526020600020905b815481526020019060010190808311610116575b5050505050905090565b6000818154811061014157fe5b90600052602060002001600091509050548156fea265627a7a7231582087b043ad63c6fe318034dab154666fec0eba7763b28451cf1cec4d1dbc1abebb64736f6c63430005100032a265627a7a7231582062acf3bff1ff54635b700f4462d602978b0847644f164d59c412a81580b938ca64736f6c63430005100032"
) {

    fun createContract(): Single<ChainResponse<TransactionCommitted>> {
        return create(listOf())
    }

    fun makeA(sender: EvmSender): Single<ChainResponse<TransactionCommitted>> {
        return executeMethod(
            "makeA",
            listOf(),
            listOf(object : TypeReference<Uint256>() { }),
            sender
        )
    }
}